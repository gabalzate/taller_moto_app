<!DOCTYPE html>
<html>
  <head>
    <title>Moto Mecánico</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-gray-100 font-sans">

    <%# Este header solo se mostrará si NO estamos en la landing page %>
    <% unless controller_name == 'pages' && action_name == 'home' %>
      <header class="bg-white shadow">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
          <%# Lado Izquierdo: Logo/Nombre de la App %>
          <div>
            <%# Este bloque comprueba si el usuario ha iniciado sesión %>
            <% if user_signed_in? %>
              <%# Si ha iniciado sesión, el enlace apunta al dashboard %>
              <%= link_to 'Moto Mecánico', dashboard_path, class: "text-xl font-bold text-gray-800" %>
            <% else %>
              <%# Si no, el enlace apunta a la landing page (comportamiento actual) %>
              <%= link_to 'Moto Mecánico', root_path, class: "text-xl font-bold text-gray-800" %>
            <% end %>
          </div>
          
          <%# --- INICIO DEL BLOQUE CORREGIDO --- %>
          <%# Lado Derecho: Acciones del Usuario %>
          <div class="flex items-center space-x-6">
            <% if user_signed_in? %>
              <%# Lógica del Chat de Soporte %>
              <% if current_user.is_super_admin? %>
                <%= link_to "Ver Chats", conversations_path, class: "text-indigo-600 hover:text-indigo-800 font-semibold" %>
              <% else %>
                <%= link_to "Chat con Soporte", conversations_path, method: :post, class: "text-indigo-600 hover:text-indigo-800 font-semibold" %>
              <% end %>
              
              <%# Botón de Cerrar Sesión %>
              <%= link_to 'Cerrar sesión', destroy_user_session_path, data: { turbo_method: :delete }, class: "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" %>
            <% else %>
              <%# Botón de Iniciar Sesión para visitantes %>
              <%= link_to 'Iniciar sesión', new_user_session_path, class: "text-gray-800 hover:text-indigo-600 font-semibold" %>
            <% end %>
          </div>
          <%# --- FIN DEL BLOQUE CORREGIDO --- %>

        </nav>
      </header>
    <% end %>

    <%# Mensajes Flash (Notice y Alert) %>
    <% if notice %>
      <div class="bg-green-100 text-green-800 p-4 text-center" role="alert">
        <%= notice %>
      </div>
    <% end %>
    <% if alert %>
      <div class="bg-red-100 text-red-800 p-4 text-center" role="alert">
        <%= alert %>
      </div>
    <% end %>

    <%# Contenido Principal de la Página %>
    <main>
      <%= yield %>
    </main>

  </body>
</html>
